% !TEX root = main.tex

% Configuration file for the document

% \usepackage{scrextend} % KOMA-script
\usepackage{graphicx}
\usepackage[tuenc]{fontspec}
\usepackage{xcolor}
\usepackage{shellesc}

\usepackage{csquotes} % Required by biblatex
\usepackage[british]{babel}
\usepackage[
  backend=biber, 
  sorting=none, 
  dateabbrev=false, 
  block=ragged,
  style=ieee
]{biblatex}

\usepackage{tikz}
\usepackage{pgfgantt}
\usepackage{pgfplots}

\usepackage{amsmath, amsfonts, amssymb} % Font symbols
\usepackage{bm}

\usepackage[format=plain,
            labelfont={bf,it},
            textfont=it]{caption}
\usepackage{subcaption}
\usepackage{fancyvrb} % Verbatim improvements
\usepackage{fancyhdr}

\usepackage{float}
\usepackage{enumitem} % Continuous enumeration
\usepackage{ragged2e} % Justify

\usepackage{array} % Table improvements
\usepackage{multirow} % Multiple rows in tables
\usepackage{makecell} % Cell colors in tables
\usepackage{hhline}   % Better line separation in tables
\usepackage{tocloft}
\usepackage{lipsum}
\usepackage[nobottomtitles*]{titlesec}

%%%%%%%%% HYPERREF %%%%%%%%%%
\usepackage[colorlinks=true,
linkcolor={red!30!black},
citecolor={blue!50!black},
urlcolor={blue!80!black}]{hyperref}

% Must be loaded after hyperref
\usepackage[acronym, toc, numberline, nopostdot, xindy, style=index]{glossaries}
\usepackage[bindingoffset=1.5cm, textwidth=15cm, top=3cm, bottom=3cm]{geometry}


%%%%%%%% END OF INCLUDES %%%%%%%%%%

\pgfplotsset{compat=1.15}
\usetikzlibrary{positioning, external}
\tikzexternalize[optimize=false, mode=list and make]
% \tikzset{%
%   % external/system call={lualatex \tikzexternalcheckshellescape --halt-on-error --interaction=batchmode --jobname "\image" "\texsource"},
%   external/system call={lualatex \tikzexternalcheckshellescape --halt-on-error --interaction=batchmode --output-directory=./build --jobname "\image" "\texsource"},
%   /pgf/images/include external/.code={%
%     \includegraphics{build/#1}%
%   },
% }

\setmainfont{CMU Serif}
\setmonofont[Scale=MatchLowercase]{Source Code Pro}
\setlength{\parskip}{\baselineskip}

\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}

% Bibliography
\addbibresource{../bibliography/mendeley.bib}

% Section defines
\newcommand{\secc}{\ifdef{\chapter}{\chapter}{\section}}
\newcommand{\ssecc}{\ifdef{\chapter}{\section}{\subsection}}
\newcommand{\sssecc}{\ifdef{\chapter}{\subsection}{\subsubsection}}

\newcommand{\seccn}{\ifdef{\chapter}{chapter}{section}}
\newcommand{\sseccn}{\ifdef{\chapter}{section}{subsection}}
\newcommand{\ssseccn}{\ifdef{\chapter}{subsection}{subsubsection}}
\newcommand{\Th}{\textsuperscript{th}}

\newcommand{\addphantomsec}[2]{%
  \cleardoublepage
  \phantomsection
  \addcontentsline{toc}{#2}{\numberline{}#1}
  \secc*{#1}
}

% Special heading, indenting the name on table of contents
\defbibheading{bibintocindent}[\refname]{%
  \secc*{#1}%
  \addcontentsline{toc}{\seccn}{\protect\numberline{}#1}%
  \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}
}

\pagestyle{fancy}

\ifdef{\chapter}{
  \renewcommand\cftchapafterpnum{\vskip15pt}
  \renewcommand\cftsecafterpnum{\vskip6pt}
  \renewcommand\cftsubsecafterpnum{\vskip3pt}
  \renewcommand{\chaptermark}[1]%
             {\markboth{\thechapter\quad#1}{}}
  \renewcommand{\sectionmark}[1]%
              {\markright{\thesection\ #1}}
}{
  \renewcommand\cftsecafterpnum{\vskip15pt}
  \renewcommand\cftsubsecafterpnum{\vskip6pt}
}

\renewcommand\cftsubsubsecafterpnum{\vskip3pt}
\renewcommand\cftfigafterpnum{\vskip5pt}
\renewcommand\cfttabafterpnum{\vskip5pt}

% List configuration
\setlist[description]{topsep=0em}
\setlist[itemize]{topsep=0em, noitemsep}
\def\mscname{Joan Marc√® i Igual}

\setlength{\headheight}{13.6pt} %add some space to headheight to eliminate LaTeX "Overfull \vbox..." warnings

\fancyhead[EL, OR]{\thepage}
\fancyhead[ER]{\rightmark}
\fancyhead[OL]{\MakeUppercase{\leftmark}}

\fancyfoot[C]{}
\fancyfoot[EL, OR]{\small\mscname}
\fancyfoot[ER, OL]{Bachelor Thesis}
\renewcommand{\footrulewidth}{0.4pt}

