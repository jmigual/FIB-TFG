% !TEX root = main.tex


\section{Project Planning}

\subsection{Planning and scheduling}

The estimated project duration is of about 4 months. The project starts on Wednesday 14th of 
February, 2018 and the deadline is on Sunday 17th June, 2018, the week before the 
presentations start.

During the development of the project there will be weekly lab meetings with my Principal
Investigator, prof. Benjamin Haibe-Kains, where the development of the project will be 
discussed. There I should show my work done and how to approach each of the problems as
they appear.

Moreover, once a week, a lab meeting will be scheduled. Its objective will be to show
the development and improvements of different lab members and receive feedback from the 
members.

It must be noticed that the initial planning can be revised and updated as a result of the 
project's evolution, feedback received from the lab members and from my Principal Investigator. 

\subsection{Task description}

\subsubsection{Acquire background in Convolutional Neural Networks}

The first step is to acquire a better understanding in how a convolutional neural network works.
Therefore, in the las month I've been learning about Convolutional Neural Networks and how they
can be used. 
I started with basic statistics applied to \emph{Machine Learning} by reading the book 
\emph{The Elements of Statistical Learning}.~\cite{ElementsStatisticalLearning}

Then, I continued by doing three courses made by \href{https://www.deeplearning.ai}{Deeplearning.ai}
and published at Coursera~\cite{Coursera} related to Convolutional Neural Networks:
\begin{itemize}
  \item \href{https://www.coursera.org/learn/neural-networks-deep-learning}{Neural Networks and 
    Deep Learning}~\cite{Coursera:NN}: Where the basic elements of a neural network and how
    to train it are explained.

  \item \href{https://www.coursera.org/learn/deep-neural-network}{Improving Deep Neural Networks: 
    Hyperparameter tuning, Regularization and Optimization}~\cite{Coursera:NNHyperparameters}: 
    In this course it's shown the importance of hyperparameters and how each one works. 
    This way then it can be easier to design a proper network. Also, the different methods 
    of regularization are explained too, so overfitting can be avoided.

  \item \href{https://www.coursera.org/learn/convolutional-neural-networks}{Convolutional Neural 
    Networks}~\cite{Coursera:CNN}:
    How the \emph{convolution} operation works and why it's used in Machine Learning. 
    Different methods of using a Convolutional Neural Network, like face recognition or 
    object detection, are taught too.
\end{itemize}

All the tasks where done in three weeks.

\subsubsection{Get familiar with survival models like DeepSurv}

Survival Prediction models are a bit different from the typical Machine Learning problem. 
In this case, the desired output values are not the event indicator \( E \) and the time
interval \( T \). What we want to obtain is the survival function \( S(t) \) or the 
hazard function \( \lambda(t) \).

DeepSurv is one of the machine learning papers using a survival model, in this case the
Cox Proportional Hazards model which is not the same I will be planning to use.

To see how to properly use a survival model in a deep learning application i should fully 
understand how this is applied in the construction of the DeepSurv neural network. During 
the task I should compare the code implementation with the theoretical models so this way
I can see how to properly use \emph{vectorization} to speed-up computation
\cites{Cox}{DeepSurv}.

This process will take around two weeks.

\subsubsection{Preprocess data}

The input data for this project are:
\begin{itemize}
  \item RAW data from CT scans. There are around 88 slices for each patient, each one of 
  a size of \( 512 \times 512 \) pixels.
  \item Tumour annotations for the CT scans. For each RAW scan there's another slice which
  is a mask of 1s and 0s where the value is 1 if there's a tumour in that pixel.
  \item Clinical data. Which has information for each patient such as:
  \begin{itemize}
    \item Age
    \item Gender
    \item Smoking Pack Years
    \item Treatment
    \item Survival time
    \item Survival event
  \end{itemize}
\end{itemize}

All these data needs to be processed and for each CT scan, the 3D slice of the tumour needs to
be extracted and the pixel values need to be normalized (setting the variance to 1 and the 
mean to 0). These operations can be done in the period of a week.

\subsubsection{Get familiar with Tensorflow}

Tensorflow is one of the biggest libraries for developing deep neural networks. It hides from the 
user the underlying details of how to train a model, like how to compute de derivatives for 
each operation to be able to implement the back propagation algorithm. Also, it's open source
so it comes at no cost.

Since it's a big piece of software and it offers many possibilities, it's very important to 
understand how it works and what is the best way to use it. The first step is to start by 
just being able to run the simple code that comes with the tutorials. Then, I should build
some simple models to test and see how to properly use the \texttt{Tensor} class that it
provides to create a computing graph and do the mathematical calculations.

This task won't take more than a week.

\subsubsection{Build shallow siamese network}

A siamese network is a type of neural network that is suited for tasks such as face recognition.
Its design usually is made from two more networks, usually called sisters, then the output
of the two sisters gets joined in an extra layer which gives us the final output 
see \autoref{fig:siamese}. Usually the two sister networks share the same parameters and
architecture so after one is designed then it's duplicated and added the joining layer.

To build it, a proper design for the sister network must be done first. Designing it will
be an iterative task where the proposed model will be trained optimizing the hyperparameters.
Then the results will be compared and some few changes will be made to try to get better results.

\begin{figure}
  \centering
  \input{drawings/siamese_network.tikz.tex}
  \caption{Siamese Network basic structure \label{fig:siamese}}
\end{figure}

The design is one of the most important parts of the project, since it will have a huge
impact in the final results. It will take around four weeks to complete and more or less
and it will be a trial and error process to try to see which architecture for the sister
network is best suited to solve the problem.

In this phase the designed networks will be very shallow to make small and fast improvements
since the training time could be an issue.

\subsubsection{Build deep siamese network}

Once a initial shallow network is already created then the next step will be to try an create
a more deep version, either using a pre-trained model or training a deep model from zero.

Using a pre-trained network will improve the development process since it will allow us
to make use of transfer learning and will have a low training time. However training the model
from zero may give us better results but although with the cost of spending too much time.
The deep network process should take two more weeks to complete.

\subsubsection{Compare the model against other ones}

Once the final deep model is created then it will be compared against different methods of 
survival analysis. Since this method will be the first one using both image data and scalar 
data it will be compared against models using only one or the other. 

The comparison will be against models using a Cox Proportional Hazards model using either
the \emph{radiomics} features extracted with \texttt{PyRadiomics} from CT scans or using 
directly the RAW image data extracted from the scans.

To do all this comparisons the same original data, the head and neck dataset, must be 
used so it may require running again the training process using the compared method. 
That's why it will take two weeks for this task to complete.

\subsection{Estimated time}

In \autoref{tab:time} an estimation of the number of hours dedicated to each task is shown.

\begin{table}[H]
  \centering{}
  \begin{tabular}{|l|r|}
    \hline
    Task & Estimated duration (h) \\ \hline \hline
    Acquire background in CNN & 120 \\ \hline
    Get familiar with survival models & 80 \\ \hline
    Preprocess data & 40 \\ \hline
    Build shallow siamese network & 200 \\ \hline
    Build deep siamese network & 80 \\ \hline
    Compare models & 80 \\ \hline
    Final stage & 160 \\ 

  
    \hline \hline
    \textbf{Total} & 760 \\
    \hline
  \end{tabular}
  \caption{Estimated time for each task \label{tab:time}}
\end{table}

\subsection{Gantt chart}

\autoref{fig:gantt} shows the planning of the different tasks of the project in a Gantt chart.

\begin{figure}[H]
  \centering{}
  \def\gantttext{4cm}
  \begin{ganttchart}[
      time slot format=isodate,
      x unit = .9mm,
      y unit title = 0.7cm,
      y unit chart = 0.5cm,
      group label font = \tiny\bf,
      title label font = \tiny,
      bar label font = \tiny,
      vgrid={*{4}{draw=none},dotted,*{2}{draw=none}},
      hgrid,
      calendar week text = {\startday},
      link bulge = 2,
    ]{2018-02-14}{2018-06-29}
    \gantttitlecalendar{month=shortname, week} \\


    % Start gantt itself
    \ganttgroup{Preamble}{2018-02-14}{2018-03-25} \\
    \ganttbar{Getting started}{2018-02-14}{2018-02-18} \\
    \ganttlinkedbar{Learn about CNN}{2018-02-19}{2018-03-11} \\
    \ganttlinkedbar{Learn about DeepSurv}{2018-03-12}{2018-03-25} \\

    
    \ganttgroup{Build siamese network}{2018-03-26}{2018-05-20} \\
    \ganttbar{Preprocess data}{2018-03-26}{2018-04-01} \\
    \ganttlinkedbar{Build shallow network}{2018-04-02}{2018-05-06} \\
    \ganttlinkedbar{Build deep network}{2018-05-07}{2018-05-20} \\

    \ganttgroup{\parbox[r]{2.3cm}{Compare models and extract conclusions}}{2018-05-21}
    {2018-06-03} \\

    \ganttbar{Compare models}{2018-05-21}{2018-05-27} \\
    \ganttlinkedbar{Extract conclusions}{2018-05-28}{2018-06-03} \\

    \ganttgroup{Final Stage}{2018-06-04}{2018-06-29} \\
    \ganttbar{Write final report}{2018-06-04}{2018-06-17} \\
    \ganttbar{End project}{2018-06-18}{2018-06-24} \\
    \ganttbar{Presentation}{2018-06-25}{2018-06-29} \\

  \end{ganttchart}
  \caption{Gantt chart of the project \label{fig:gantt}}
\end{figure}

\subsection{Alternatives and action plan}

As it has already been said, the fact that there will be weekly meetings will allow to 
revise and adapt the initial planning. This means that the real duration compared to the 
planned one of a specific task may differ, and thus the planning will be changed 
accordingly. If a task is finished before planned then the next task will start
immediately. Moreover, if a task duration is longer than expected then the following tasks
will need to be rescheduled or, in the worst case, omitted. In this 

\subsubsection{Complexity of the built model}

Since the model that I am aiming to build is quite complex it will have a constant trial
and error and so it may take longer than expected to finish. To 

\subsubsection{Bugs}

\subsubsection{Unavailability of SharcNet}

\subsubsection{Training times}
